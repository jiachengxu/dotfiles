# =============================================================================
# Simple tmux config with Flexoki Light theme
# =============================================================================

# -- General ------------------------------------------------------------------

set -g default-terminal "tmux-256color"
set -ga terminal-features ",xterm-256color:RGB"
set -s escape-time 10                     # faster command sequences
set -sg repeat-time 0                     # disable repeat for immediate response
set -s focus-events on

set -g history-limit 10000                # boost history

# UTF-8
set -q -g status-utf8 on
setw -q -g utf8 on

# -- Prefix -------------------------------------------------------------------

unbind C-b
set -g prefix C-a
bind C-a send-prefix

# -- Display ------------------------------------------------------------------

set -g base-index 1           # start windows numbering at 1
setw -g pane-base-index 1     # make pane numbering consistent with windows
setw -g automatic-rename on   # rename window to reflect current program
set -g renumber-windows on    # renumber windows when a window is closed
set -g set-titles on          # set terminal title
set -g set-titles-string "#h - #S - #W"

# -- Mouse & Input ------------------------------------------------------------

set -g mouse on
set -g extended-keys on
set -as terminal-features 'xterm*:extkeys'
set -g allow-passthrough on

# -- Vi Mode ------------------------------------------------------------------

set -g status-keys vi
set -g mode-keys vi

# Copy mode vi bindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi Escape send-keys -X cancel

# -- Key Bindings -------------------------------------------------------------

# Reload config
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Split panes using | and - (more intuitive)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# New window retains current path
bind c new-window -c "#{pane_current_path}"

# Pane resizing with vi keys
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# -- vim-tmux-navigator -------------------------------------------------------
# Smart pane switching with awareness of Vim splits
# See: https://github.com/christoomey/vim-tmux-navigator

is_vim="ps -o state= -o comm= -t '#{pane_tty}' \
    | grep -iqE '^[^TXZ ]+ +(\\S+\\/)?g?(view|n?vim?x?)(diff)?$'"

bind-key -n 'C-h' if-shell "$is_vim" 'send-keys C-h' 'select-pane -L'
bind-key -n 'C-j' if-shell "$is_vim" 'send-keys C-j' 'select-pane -D'
bind-key -n 'C-k' if-shell "$is_vim" 'send-keys C-k' 'select-pane -U'
bind-key -n 'C-l' if-shell "$is_vim" 'send-keys C-l' 'select-pane -R'

tmux_version='$(tmux -V | sed -En "s/^tmux ([0-9]+(.[0-9]+)?).*/\1/p")'
if-shell -b '[ "$(echo "$tmux_version < 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\'  'select-pane -l'"
if-shell -b '[ "$(echo "$tmux_version >= 3.0" | bc)" = 1 ]' \
    "bind-key -n 'C-\\' if-shell \"$is_vim\" 'send-keys C-\\\\'  'select-pane -l'"

bind-key -T copy-mode-vi 'C-h' select-pane -L
bind-key -T copy-mode-vi 'C-j' select-pane -D
bind-key -T copy-mode-vi 'C-k' select-pane -U
bind-key -T copy-mode-vi 'C-l' select-pane -R
bind-key -T copy-mode-vi 'C-\' select-pane -l

# =============================================================================
# Flexoki Light Theme
# =============================================================================

# Colors
# Paper (bg): #FFFCF0
# UI:         #E6E4D9
# Text (fg):  #100F0F
# Blue:       #205EA6
# Yellow:     #AD8301
# Cyan:       #24837B
# Red:        #AF3029
# Green:      #66800B
# Purple:     #5E409D

# -- Status Bar (Powerline style) ---------------------------------------------

set -g status-position bottom
set -g status-justify left
set -g status-interval 1

# Status bar background
set -g status-style "bg=#E6E4D9,fg=#100F0F"

# Left: Session name with powerline arrow
set -g status-left-length 40
set -g status-left "#[fg=#FFFCF0,bg=#24837B,bold]  #S #[fg=#24837B,bg=#E6E4D9]"

# Right: Date | Time | Hostname
set -g status-right-length 100
set -g status-right "#[fg=#66800B,bg=#E6E4D9]#[fg=#FFFCF0,bg=#66800B,bold] %b %d #[fg=#205EA6,bg=#66800B]#[fg=#FFFCF0,bg=#205EA6,bold] %H:%M #[fg=#24837B,bg=#205EA6]#[fg=#FFFCF0,bg=#24837B,bold] #h "

# Inactive windows
setw -g window-status-format "#[fg=#E6E4D9,bg=#B7B5AC]#[fg=#100F0F] #I #W #[fg=#B7B5AC,bg=#E6E4D9]"

# Active window
setw -g window-status-current-format "#[fg=#E6E4D9,bg=#205EA6]#[fg=#FFFCF0,bold] #I #W #[fg=#205EA6,bg=#E6E4D9]"

# Window separator
setw -g window-status-separator ""

# Activity & Bell
setw -g window-status-activity-style "fg=#AD8301,underscore"
setw -g window-status-bell-style "fg=#AF3029,bold"

# -- Panes --------------------------------------------------------------------

set -g pane-border-style "fg=#E6E4D9"
set -g pane-active-border-style "fg=#205EA6"

# Pane indicator (prefix + q)
set -g display-panes-colour "#6F6E69"
set -g display-panes-active-colour "#205EA6"

# -- Messages -----------------------------------------------------------------

set -g message-style "fg=#FFFCF0,bg=#AD8301,bold"
set -g message-command-style "fg=#AD8301,bg=#FFFCF0,bold"

# -- Clock (prefix + t) -------------------------------------------------------

setw -g clock-mode-colour "#205EA6"
setw -g clock-mode-style 24

# -- Copy mode ----------------------------------------------------------------

setw -g mode-style "fg=#FFFCF0,bg=#205EA6,bold"

# =============================================================================
# Plugins (TPM)
# =============================================================================

# Install TPM if not present
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm'"

# Plugins
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'

# Plugin settings
set -g @resurrect-capture-pane-contents 'on'
set -g @continuum-save-interval '10'
set -g @continuum-restore 'on'

# Initialize TPM (keep this at the very bottom)
run '~/.tmux/plugins/tpm/tpm'
